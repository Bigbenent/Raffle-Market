<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard | Overview</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Custom Styles -->
  <link href="css/style.css" rel="stylesheet" />
</head>

<body>
    <!-- Sidebar -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <h4 class="fw-bold text-success mb-0">Admin<span class="text-dark">Panel</span></h4>
      <button class="btn btn-sm btn-outline-secondary d-lg-none" id="sidebarToggle"><i class="bi bi-x-lg"></i></button>
    </div>

    <ul class="sidebar-menu list-unstyled mt-4">
      <li><a href="overview.html" class="active"><i class="bi bi-house-door me-2"></i> Dashboard</a></li>
      <li><a href="#"><i class="bi bi-people me-2"></i> Users</a></li>
     <li class="nav-item dropdown">
  <a href="#" class="nav-link d-flex align-items-center justify-content-between" data-bs-toggle="collapse" data-bs-target="#drawDropdown" aria-expanded="false">
    <span><i class="bi bi-ticket-detailed me-2"></i> Draws</span>
    <i class="bi bi-chevron-down small"></i>
  </a>
  <ul class="collapse list-unstyled ms-4 mt-1" id="drawDropdown">
    <li><a href="add-draws.html" class="nav-link"><i class="bi bi-plus-circle me-2"></i> Add Draw</a></li>
    <li><a href="manage-draws.html" class="nav-link"><i class="bi bi-gear me-2"></i> Manage Draws</a></li>
  </ul>
</li>

      <li><a href="transactions.html"><i class="bi bi-wallet2 me-2"></i> Transactions</a></li>
      <li><a href="settings.html"><i class="bi bi-envelope me-2"></i> Support</a></li>
      <li><a href="settings.html"><i class="bi bi-gear me-2"></i> Settings</a></li>
    </ul>
  </aside>

  
  <!-- Main Content -->
  <main class="main-content">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top py-3 px-4">
      <button class="btn btn-outline-success me-3 d-lg-none" id="sidebarToggleMobile"><i class="bi bi-list"></i></button>
      <h5 class="fw-bold text-dark mb-0">Dashboard Overview</h5>
      <div class="ms-auto d-flex align-items-center gap-3">
        <button class="btn btn-light" id="themeToggle"><i class="bi bi-moon"></i></button>
        <div class="dropdown">
          <a href="#" class="d-flex align-items-center text-decoration-none" data-bs-toggle="dropdown">
            <img src="../img/logo.png" class="rounded-circle me-2" width="40" height="40" alt="Admin">
            <span class="fw-semibold">Admin</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end shadow-sm">
            <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Profile</a></li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
            <li><hr class="dropdown-divider" /></li>
            <li><a class="dropdown-item text-danger" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
          </ul>
        </div>
      </div>
    </nav>


    <!-- Page Content -->
    <div class="container-fluid p-4">
  
<!-- SECURITY & ACCESS CONTROL MAIN CONTENT -->
<div class="container-fluid py-4 px-3" id="security-page">

  <!-- Header -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-gradient mb-2">🔒 Security & Access Control</h3>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary btn-sm" id="exportLogsBtn"><i class="bi bi-file-earmark-arrow-down"></i> Export Logs</button>
      <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addAdminModal"><i class="bi bi-person-plus"></i> Add Admin</button>
    </div>
  </div>

  <!-- Top overview cards -->
  <div class="row g-3 mb-4">
    <div class="col-sm-6 col-md-3">
      <div class="card shadow-sm p-3 h-100">
        <small class="text-muted">Total Admins</small>
        <div class="d-flex align-items-center justify-content-between mt-2">
          <h4 class="mb-0" id="totalAdmins">5</h4>
          <i class="bi bi-people fs-3 text-primary"></i>
        </div>
        <small class="text-muted">Roles: Super / Finance / Support</small>
      </div>
    </div>
    <div class="col-sm-6 col-md-3">
      <div class="card shadow-sm p-3 h-100">
        <small class="text-muted">2FA Enabled</small>
        <div class="d-flex align-items-center justify-content-between mt-2">
          <h4 class="mb-0 text-success" id="twoFaCount">3</h4>
          <i class="bi bi-shield-lock fs-3 text-success"></i>
        </div>
        <small class="text-muted">Encourage for all admins</small>
      </div>
    </div>
    <div class="col-sm-6 col-md-3">
      <div class="card shadow-sm p-3 h-100">
        <small class="text-muted">Active Sessions</small>
        <div class="d-flex align-items-center justify-content-between mt-2">
          <h4 class="mb-0" id="activeSessions">7</h4>
          <i class="bi bi-terminal fs-3 text-warning"></i>
        </div>
        <small class="text-muted">IP & device monitoring</small>
      </div>
    </div>
    <div class="col-sm-6 col-md-3">
      <div class="card shadow-sm p-3 h-100">
        <small class="text-muted">Recent Alerts</small>
        <div class="d-flex align-items-center justify-content-between mt-2">
          <h4 class="mb-0 text-danger" id="recentAlerts">1</h4>
          <i class="bi bi-exclamation-triangle fs-3 text-danger"></i>
        </div>
        <small class="text-muted">Failed logins / suspicious IPs</small>
      </div>
    </div>
  </div>

  <!-- Role & Permission manager + Admin users -->
  <div class="row g-4">
    <!-- Roles & Permissions -->
    <div class="col-lg-5">
      <div class="card shadow-sm p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">Role Management</h5>
          <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addRoleModal">
            <i class="bi bi-plus-lg"></i> New Role
          </button>
        </div>

        <div class="mb-3 small text-muted">Create predefined roles and toggle permissions. Use least privilege principle.</div>

        <div id="rolesList" class="list-group mb-2">
          <!-- roles are injected by JS -->
        </div>

        <div class="pt-2">
          <h6 class="mb-2">Permission Matrix (selected role)</h6>
          <div id="permMatrix" class="row gy-2">
            <!-- matrix injected by JS -->
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Users -->
    <div class="col-lg-7">
      <div class="card shadow-sm p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Admin Users</h5>
          <div class="d-flex gap-2">
            <input id="adminSearch" class="form-control form-control-sm" placeholder="Search name or email" style="min-width:200px;">
            <select id="roleFilter" class="form-select form-select-sm" style="width:160px;">
              <option value="">All Roles</option>
            </select>
          </div>
        </div>

        <div class="table-responsive">
          <table id="adminsTable" class="table table-hover table-sm align-middle">
            <thead class="table-light">
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>2FA</th>
                <th>Last login</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- injected by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Sessions & IP monitoring + Activity log -->
  <div class="row g-4 mt-3">
    <div class="col-lg-6">
      <div class="card shadow-sm p-3 h-100">
        <h5 class="mb-3">Active Sessions & IPs</h5>
        <div class="table-responsive" style="max-height:300px;overflow:auto">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light small">
              <tr><th>IP</th><th>Device</th><th>Location</th><th>Started</th><th>Action</th></tr>
            </thead>
            <tbody id="sessionsBody">
              <!-- js -->
            </tbody>
          </table>
        </div>
        <small class="text-muted mt-2 d-block">Terminate suspicious sessions to revoke tokens immediately.</small>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm p-3 h-100">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">Admin Activity Log</h5>
          <div class="d-flex gap-2">
            <input id="logSearch" class="form-control form-control-sm" placeholder="Search logs" style="min-width:180px">
            <button class="btn btn-sm btn-outline-secondary" id="clearLogsBtn">Clear (demo)</button>
          </div>
        </div>

        <div class="table-responsive" style="max-height:300px; overflow:auto">
          <table id="activityLog" class="table table-sm align-middle mb-0">
            <thead class="table-light small">
              <tr><th>Time</th><th>Admin</th><th>Action</th><th>IP</th></tr>
            </thead>
            <tbody>
              <!-- injected by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer note -->
  <div class="mt-3 small text-muted">Security best practices: use salted & iterated password hashing (e.g. bcrypt/scrypt/Argon2), rotate API keys, log admins actions to WORM storage, and monitor IP anomalies.</div>
</div>

<!-- ===== Modals ===== -->
<!-- Add Admin Modal -->
<div class="modal fade" id="addAdminModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title">Add Admin</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="addAdminForm">
        <div class="modal-body">
          <div class="mb-2"><label class="form-label small">Full name</label><input id="newAdminName" class="form-control form-control-sm" required></div>
          <div class="mb-2"><label class="form-label small">Email</label><input id="newAdminEmail" class="form-control form-control-sm" type="email" required></div>
          <div class="mb-2"><label class="form-label small">Role</label><select id="newAdminRole" class="form-select form-select-sm"></select></div>
          <div class="form-check form-switch mb-2">
            <input class="form-check-input" type="checkbox" id="force2FA">
            <label class="form-check-label small">Require 2FA on first login</label>
          </div>
          <div class="mb-2 small text-muted">A temporary password will be emailed (demo).</div>
        </div>
        <div class="modal-footer"><button class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button><button class="btn btn-sm btn-primary">Create</button></div>
      </form>
    </div>
  </div>
</div>

<!-- Add/Edit Role Modal -->
<div class="modal fade" id="addRoleModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title">Create Role</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="roleForm">
        <div class="modal-body">
          <div class="mb-2"><label class="form-label small">Role name</label><input id="roleName" class="form-control form-control-sm" required></div>
          <div class="mb-2"><label class="form-label small">Description</label><input id="roleDesc" class="form-control form-control-sm"></div>
          <div class="mb-2 small text-muted">Pick permissions below</div>
          <div class="row g-2">
            <div class="col-6"><div class="form-check"><input class="form-check-input perm-check" data-perm="manage_users" type="checkbox" id="perm1"><label class="form-check-label small" for="perm1">Manage Users</label></div></div>
            <div class="col-6"><div class="form-check"><input class="form-check-input perm-check" data-perm="manage_finance" type="checkbox" id="perm2"><label class="form-check-label small" for="perm2">Finance Actions</label></div></div>
            <div class="col-6"><div class="form-check"><input class="form-check-input perm-check" data-perm="view_logs" type="checkbox" id="perm3"><label class="form-check-label small" for="perm3">View Logs</label></div></div>
            <div class="col-6"><div class="form-check"><input class="form-check-input perm-check" data-perm="manage_roles" type="checkbox" id="perm4"><label class="form-check-label small" for="perm4">Manage Roles</label></div></div>
          </div>
        </div>
        <div class="modal-footer"><button class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button><button class="btn btn-sm btn-primary">Save Role</button></div>
      </form>
    </div>
  </div>
</div>

<!-- Session details modal -->
<div class="modal fade" id="sessionModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-3">
      <div class="modal-header"><h5 class="modal-title">Session Details</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body small">
        <div id="sessionDetails"></div>
      </div>
      <div class="modal-footer"><button class="btn btn-sm btn-danger" id="terminateSessionBtn">Terminate Session</button></div>
    </div>
  </div>
</div>

<!-- Styles (add to your stylesheet) -->
<style>
  #security-page .card { border-radius: 12px; }
  .text-gradient { background: linear-gradient(90deg,#007bff,#6610f2); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
  #rolesList .list-group-item { cursor:pointer; }
  #permMatrix .form-check { padding: .35rem; border-radius:8px; background:#f8fafc; margin-bottom:.35rem; }
  body.dark-mode #permMatrix .form-check { background:#0f1724; color:#e6eef8; }
  .small-muted { color:#6b7280; }
  /* Responsive tweaks */
  @media (max-width: 768px) {
    #security-page .d-flex.gap-2 { flex-direction:column; gap:.5rem; }
    #rolesList, #permMatrix { font-size: .95rem; }
    #sessionsBody, #activityLog tbody { font-size: .85rem; }
  }
</style>

<!-- Dependencies: DataTables + optionally jQuery (used for initialization in this demo) -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<!-- Demo JS: Populate UI & interactions (replace with API calls) -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ---------- Demo data ---------- */
  const roles = [
    { id:'super', name:'Super Admin', desc:'Full access', perms:['manage_users','manage_finance','view_logs','manage_roles'] },
    { id:'finance', name:'Finance Admin', desc:'Approve payouts', perms:['manage_finance','view_logs'] },
    { id:'support', name:'Support Staff', desc:'Helpdesk operations', perms:['view_logs'] }
  ];
  const admins = [
    { id:'A001', name:'Ada N.', email:'ada@biz.com', role:'Super Admin', twofa:true, last:'2025-10-12 09:10', avatar:'' },
    { id:'A002', name:'Chike O.', email:'chike@biz.com', role:'Finance Admin', twofa:true, last:'2025-10-13 07:22', avatar:'' },
    { id:'A003', name:'Lucy P.', email:'lucy@biz.com', role:'Support Staff', twofa:false, last:'2025-10-10 18:44', avatar:'' }
  ];
  const sessions = [
    { ip:'154.66.1.2', device:'Chrome / Win10', loc:'Lagos, NG', started:'2025-10-13 08:10' },
    { ip:'41.62.3.74', device:'Safari / iPhone', loc:'Abuja, NG', started:'2025-10-13 07:50' }
  ];
  const logs = [
    { t:'2025-10-13 09:00', admin:'Ada N', action:'Approved withdrawal ₦50,000', ip:'154.66.1.2' },
    { t:'2025-10-12 15:22', admin:'Chike O', action:'Created role Finance Admin', ip:'154.66.1.2' },
    { t:'2025-10-11 11:12', admin:'Lucy P', action:'Viewed user profile INV003', ip:'41.62.3.74' }
  ];

  /* ---------- populate roles list & role filter ---------- */
  const rolesList = document.getElementById('rolesList');
  const roleFilter = document.getElementById('roleFilter');
  const newAdminRole = document.getElementById('newAdminRole');
  roles.forEach(r=>{
    const li = document.createElement('button');
    li.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center';
    li.innerHTML = `<div><strong>${r.name}</strong><div class="small text-muted">${r.desc}</div></div><span class="badge bg-secondary">${r.perms.length}</span>`;
    li.addEventListener('click', ()=>selectRole(r.id));
    rolesList.appendChild(li);

    const opt = document.createElement('option'); opt.value = r.name; opt.textContent = r.name; roleFilter.appendChild(opt);
    const opt2 = document.createElement('option'); opt2.value = r.name; opt2.textContent = r.name; newAdminRole.appendChild(opt2);
  });

  function selectRole(roleId){
    const role = roles.find(r => r.id === roleId);
    if(!role) return;
    // show permissions matrix
    const perms = ['manage_users','manage_finance','view_logs','manage_roles'];
    const permNames = {manage_users:'Manage Users', manage_finance:'Finance Actions', view_logs:'View Logs', manage_roles:'Manage Roles'};
    const matrix = document.getElementById('permMatrix'); matrix.innerHTML = '';
    perms.forEach(p=>{
      const checked = role.perms.includes(p) ? 'checked' : '';
      const wrapper = document.createElement('div');
      wrapper.className = 'col-12';
      wrapper.innerHTML = `<div class="form-check">
        <input class="form-check-input" type="checkbox" id="pm-${p}" ${checked} />
        <label class="form-check-label small" for="pm-${p}">${permNames[p]}</label>
      </div>`;
      matrix.appendChild(wrapper);
    });
  }

  // select default role
  selectRole('super');

  /* ---------- populate admins table ---------- */
  const adminsTbody = document.querySelector('#adminsTable tbody');
  function renderAdmins(filterRole='', q=''){
    adminsTbody.innerHTML = '';
    admins.forEach((a, i)=>{
      if(filterRole && a.role !== filterRole) return;
      const text = (a.name+' '+a.email).toLowerCase();
      if(q && !text.includes(q.toLowerCase())) return;
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${i+1}</td>
        <td><div class="fw-semibold">${a.name}</div></td>
        <td>${a.email}</td>
        <td>${a.role}</td>
        <td>${a.twofa ? '<span class="badge bg-success">Enabled</span>' : '<span class="badge bg-secondary">Disabled</span>'}</td>
        <td>${a.last}</td>
        <td>
          <div class="d-flex gap-1">
            <button class="btn btn-sm btn-outline-primary" data-id="${a.id}" data-action="view">View</button>
            <button class="btn btn-sm btn-outline-warning" data-id="${a.id}" data-action="edit">Edit</button>
            <button class="btn btn-sm btn-outline-danger" data-id="${a.id}" data-action="delete">Delete</button>
          </div>
        </td>`;
      adminsTbody.appendChild(tr);
    });
  }
  renderAdmins();

  /* filters/search for admins */
  document.getElementById('roleFilter').addEventListener('change', (e)=> renderAdmins(e.target.value));
  document.getElementById('adminSearch').addEventListener('input', (e)=> renderAdmins(document.getElementById('roleFilter').value, e.target.value));

  /* admins table actions (view/edit/delete) - demo handlers */
  document.querySelector('#adminsTable tbody').addEventListener('click', (ev)=>{
    const btn = ev.target.closest('button');
    if(!btn) return;
    const action = btn.dataset.action;
    const id = btn.dataset.id;
    const admin = admins.find(a=>a.id===id);
    if(action === 'view') {
      alert('View admin (demo): ' + (admin ? admin.name : id));
    } else if(action === 'edit') {
      alert('Edit admin (demo): ' + (admin ? admin.name : id));
    } else if(action === 'delete') {
      if(confirm('Delete admin? This is irreversible (demo).')) {
        // demo delete
        const idx = admins.findIndex(a=>a.id===id);
        if(idx>-1) admins.splice(idx,1);
        renderAdmins();
      }
    }
  });

  /* ---------- sessions & activity logs ---------- */
  const sessionsBody = document.getElementById('sessionsBody');
  sessions.forEach(s=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${s.ip}</td><td class="small">${s.device}</td><td>${s.loc}</td><td>${s.started}</td>
      <td><button class="btn btn-sm btn-outline-danger" data-ip="${s.ip}" onclick="terminateSessionDemo(this)">Terminate</button></td>`;
    sessionsBody.appendChild(tr);
  });

  // populate activity log
  const logTbody = document.querySelector('#activityLog tbody');
  logs.forEach(l=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${l.t}</td><td>${l.admin}</td><td>${l.action}</td><td>${l.ip}</td>`;
    logTbody.appendChild(tr);
  });

  /* simple search over activity logs */
  document.getElementById('logSearch').addEventListener('input', function(){
    const q = this.value.toLowerCase();
    Array.from(logTbody.children).forEach(tr=>{
      tr.style.display = tr.textContent.toLowerCase().includes(q) ? '' : 'none';
    });
  });

  document.getElementById('clearLogsBtn').addEventListener('click', ()=> {
    if(!confirm('Clear logs (demo)?')) return;
    logTbody.innerHTML = '';
  });

  /* ---------- activity table DataTable (optional) ---------- */
  if(window.jQuery && $.fn.dataTable) {
    $('#activityLog').DataTable({ pageLength: 5, lengthChange:false, order:[[0,'desc']] });
    $('#adminsTable').DataTable({ pageLength: 5, lengthChange:false });
  }

  /* export logs demo */
  document.getElementById('exportLogsBtn').addEventListener('click', ()=> alert('Export logs (demo)'));

  /* add role form (demo) */
  document.getElementById('roleForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const name = document.getElementById('roleName').value.trim();
    const desc = document.getElementById('roleDesc').value.trim();
    if(!name) return alert('Role name required');
    roles.push({ id: name.toLowerCase().replace(/\s+/g,'_'), name, desc, perms: Array.from(document.querySelectorAll('.perm-check:checked')).map(c=>c.dataset.perm) });
    $('#addRoleModal').modal('hide');
    location.reload(); // quick demo refresh: in prod re-render lists dynamically
  });

  /* add admin (demo) */
  document.getElementById('addAdminForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const name = document.getElementById('newAdminName').value.trim();
    const email = document.getElementById('newAdminEmail').value.trim();
    const role = document.getElementById('newAdminRole').value;
    admins.push({ id:'A'+(Math.random()*9000|0), name, email, role, twofa: false, last: '—' });
    $('#addAdminModal').modal('hide');
    renderAdmins();
  });

  /* terminate session demo handler (global) */
  window.terminateSessionDemo = function(btn){
    if(!confirm('Terminate session ' + btn.dataset.ip + '?')) return;
    btn.closest('tr').remove();
  };

});
</script>


    </div>

    <!-- Footer -->
    <footer class="footer py-3 text-center border-top mt-auto">
      <p class="mb-0 small text-muted">© 2025 AdminPanel. Built with ❤️ by BenCode Team</p>
    </footer>
  </main>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="Js/main.js"></script>
</body>
</html>
