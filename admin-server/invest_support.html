<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard | Overview</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Custom Styles -->
  <link href="css/style.css" rel="stylesheet" />
</head>
<!-- ===================== STYLES ===================== -->
<style>
/* ===== General Theme Enhancements ===== */
body {
  font-family: 'Inter', 'Poppins', sans-serif;
  background: #f9fafc;
  color: #0f172a;
  transition: all 0.3s ease;
}
body.dark-mode {
  background: #0f1724;
  color: #e2e8f0;
}

/* ===== Gradient Text ===== */
.text-gradient {
  background: linear-gradient(90deg, #0ea5a4, #06b6d4);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* ===== Card Design ===== */
.card {
  background: forestgreen;
  border-radius: 1.2rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  transition: all 0.3s ease;
  border: none;
  overflow: hidden;
  position: relative;
}
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
}
.card .card-header {
  font-weight: 600;
  border-bottom: 1px solid rgba(0,0,0,0.05);
  background: transparent;
}
.card .card-body {
  padding: 1.5rem;
}

/* ===== Dark Mode Card ===== */
body.dark-mode .card {
  background: rgba(17,25,40,0.85);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.05);
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
}

/* ===== Card Stats (for dashboard & wallet) ===== */
.stat-card {
  background: linear-gradient(135deg, #06b6d4, #0ea5a4);
  color: #fff;
  padding: 1.5rem;
  border-radius: 1rem;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}
.stat-card::after {
  content: "";
  position: absolute;
  top: -30%;
  right: -30%;
  width: 150%;
  height: 150%;
  background: rgba(255,255,255,0.08);
  transform: rotate(25deg);
}
.stat-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(6,182,212,0.3);
}
body.dark-mode .stat-card {
  background: linear-gradient(135deg, #0f766e, #14b8a6);
}

/* ===== Conversation Bubbles ===== */
#conversation {
  display: flex;
  flex-direction: column;
}
#conversation .bubble {
  max-width: 85%;
  padding: 12px 16px;
  border-radius: 14px;
  margin-bottom: 10px;
  font-size: 0.95rem;
  line-height: 1.5;
  display: inline-block;
  word-break: break-word;
}
#conversation .bubble.from-investor {
  background: #f1f5f9;
  align-self: flex-start;
}
#conversation .bubble.from-admin {
  background: #e6fffa;
  align-self: flex-end;
}
body.dark-mode #conversation .bubble.from-investor {
  background: #1e293b;
  color: #e2e8f0;
}
body.dark-mode #conversation .bubble.from-admin {
  background: #0d9488;
  color: #f8fafc;
}

/* ===== Modals Responsive ===== */
@media (max-width: 575px) {
  #support-center .card {
    font-size: 0.95rem;
  }
  #composeModal .modal-dialog,
  #viewTicketModal .modal-dialog {
    max-width: 95%;
    margin: auto;
  }
  .card .card-body {
    padding: 1rem;
  }
}

/* ===== Buttons & Inputs ===== */
.btn-gradient {
  background: linear-gradient(90deg, #0ea5a4, #06b6d4);
  color: #fff;
  border: none;
  border-radius: 0.75rem;
  transition: all 0.3s ease;
}
.btn-gradient:hover {
  opacity: 0.9;
  transform: scale(1.02);
}
body.dark-mode .btn-gradient {
  background: linear-gradient(90deg, #0d9488, #14b8a6);
}

/* ===== DataTable Styling ===== */
table.dataTable {
  border-radius: 1rem !important;
  overflow: hidden;
}
table.dataTable thead {
  background: linear-gradient(90deg, #0ea5a4, #06b6d4);
  color: #fff;
}
body.dark-mode table.dataTable thead {
  background: linear-gradient(90deg, #0f766e, #14b8a6);
}
table.dataTable tbody tr:hover {
  background-color: rgba(6,182,212,0.05);
}
body.dark-mode table.dataTable tbody tr:hover {
  background-color: rgba(20,184,166,0.1);
}
</style>

<body>
    <!-- Sidebar -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <h4 class="fw-bold text-success mb-0">Admin<span class="text-dark">Panel</span></h4>
      <button class="btn btn-sm btn-outline-secondary d-lg-none" id="sidebarToggle"><i class="bi bi-x-lg"></i></button>
    </div>

    <ul class="sidebar-menu list-unstyled mt-4">
      <li><a href="overview.html" class="active"><i class="bi bi-house-door me-2"></i> Dashboard</a></li>
      <li><a href="#"><i class="bi bi-people me-2"></i> Users</a></li>
     <li class="nav-item dropdown">
  <a href="#" class="nav-link d-flex align-items-center justify-content-between" data-bs-toggle="collapse" data-bs-target="#drawDropdown" aria-expanded="false">
    <span><i class="bi bi-ticket-detailed me-2"></i> Draws</span>
    <i class="bi bi-chevron-down small"></i>
  </a>
  <ul class="collapse list-unstyled ms-4 mt-1" id="drawDropdown">
    <li><a href="add-draws.html" class="nav-link"><i class="bi bi-plus-circle me-2"></i> Add Draw</a></li>
    <li><a href="manage-draws.html" class="nav-link"><i class="bi bi-gear me-2"></i> Manage Draws</a></li>
  </ul>
</li>

      <li><a href="transactions.html"><i class="bi bi-wallet2 me-2"></i> Transactions</a></li>
      <li><a href="settings.html"><i class="bi bi-envelope me-2"></i> Support</a></li>
      <li><a href="settings.html"><i class="bi bi-gear me-2"></i> Settings</a></li>
    </ul>
  </aside>

  
  <!-- Main Content -->
  <main class="main-content">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top py-3 px-4">
      <button class="btn btn-outline-success me-3 d-lg-none" id="sidebarToggleMobile"><i class="bi bi-list"></i></button>
      <h5 class="fw-bold text-dark mb-0">Dashboard Overview</h5>
      <div class="ms-auto d-flex align-items-center gap-3">
        <button class="btn btn-light" id="themeToggle"><i class="bi bi-moon"></i></button>
        <div class="dropdown">
          <a href="#" class="d-flex align-items-center text-decoration-none" data-bs-toggle="dropdown">
            <img src="../img/logo.png" class="rounded-circle me-2" width="40" height="40" alt="Admin">
            <span class="fw-semibold">Admin</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end shadow-sm">
            <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Profile</a></li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
            <li><hr class="dropdown-divider" /></li>
            <li><a class="dropdown-item text-danger" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
          </ul>
        </div>
      </div>
    </nav>


    <!-- Page Content -->
    <div class="container-fluid p-4">
  
<!-- SUPPORT & COMMUNICATION CENTER (MAIN CONTENT ONLY) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

<div class="container-fluid py-4" id="support-center">

  <!-- Header -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-2">
    <div>
      <h3 class="fw-bold text-gradient mb-0">üì® Support & Communication Center</h3>
      <small class="text-muted">Manage tickets, respond to investors, and maintain FAQs.</small>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#composeModal">
        <i class="bi bi-envelope-paper"></i> Bulk Email / Notification
      </button>
      <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createTicketModal">
        <i class="bi bi-plus-circle"></i> New Ticket
      </button>
    </div>
  </div>

  <!-- Stats -->
  <div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
      <div class="card bg-success text-light p-3 shadow-sm">
        <small class="text-muted">Total Tickets</small>
        <h4 id="statTotal">0</h4>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card bg-success text-light p-3 shadow-sm">
        <small class="text-muted">Open</small>
        <h4 id="statOpen" class="text-light">0</h4>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card bg-success text-light p-3 shadow-sm">
        <small class="text-muted">Resolved</small>
        <h4 id="statResolved" class="text-light">0</h4>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card bg-success text-light p-3 shadow-sm">
        <small class="text-muted">Pending</small>
        <h4 id="statPending" class="text-light">0</h4>
      </div>
    </div>
  </div>

  <!-- Tabs: Tickets / FAQ / Bulk Messages -->
  <ul class="nav nav-tabs mb-3" id="scTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-tickets" data-bs-toggle="tab" data-bs-target="#tabTickets" type="button">Tickets</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-faq" data-bs-toggle="tab" data-bs-target="#tabFaq" type="button">FAQ Editor</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-bulk" data-bs-toggle="tab" data-bs-target="#tabBulk" type="button">Bulk Messaging</button>
    </li>
  </ul>

  <div class="tab-content">

    <!-- ========== TICKETS TAB ========== -->
    <div class="tab-pane fade show active" id="tabTickets">
      <div class="card mb-3 p-3 shadow-sm">
        <div class="row g-2 align-items-center">
          <div class="col-md-5">
            <input id="ticketSearch" class="form-control" placeholder="Search by investor name, ticket ID or subject">
          </div>
          <div class="col-md-3">
            <select id="ticketStatusFilter" class="form-select">
              <option value="">All status</option>
              <option value="open">Open</option>
              <option value="pending">Pending</option>
              <option value="resolved">Resolved</option>
            </select>
          </div>
          <div class="col-md-2">
            <select id="ticketAssigneeFilter" class="form-select">
              <option value="">All assignees</option>
              <option value="Support Staff">Support Staff</option>
              <option value="Finance Admin">Finance Admin</option>
            </select>
          </div>
          <div class="col-md-2 text-end">
            <button class="btn btn-outline-secondary" id="refreshTicketsBtn"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
          </div>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-body">
          <div class="table-responsive">
            <table id="ticketsTable" class="table table-striped table-hover w-100">
              <thead class="table-light small">
                <tr>
                  <th>#</th>
                  <th>Ticket ID</th>
                  <th>Investor</th>
                  <th>Subject</th>
                  <th>Assigned</th>
                  <th>Status</th>
                  <th>Last Updated</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody><!-- populated by JS --></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== FAQ TAB ========== -->
    <div class="tab-pane fade" id="tabFaq">
      <div class="card p-3 mb-3 shadow-sm">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">FAQ Management</h5>
          <div class="d-flex gap-2">
            <input id="faqSearch" class="form-control form-control-sm" placeholder="Search FAQs" style="min-width:200px">
            <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#faqAddModal"><i class="bi bi-plus-lg"></i> Add FAQ</button>
          </div>
        </div>

        <div class="table-responsive">
          <table id="faqTable" class="table table-hover w-100">
            <thead class="table-light small">
              <tr>
                <th>#</th>
                <th>Question</th>
                <th>Category</th>
                <th>Visibility</th>
                <th>Updated</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody><!-- populated by JS --></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ========== BULK MESSAGING TAB (summary view) ========== -->
    <div class="tab-pane fade" id="tabBulk">
      <div class="card p-3 shadow-sm">
        <h5 class="mb-3">Bulk Messaging Summary</h5>
        <p class="small text-muted">Use the bulk composer to send announcements, policy changes, or promotional messages. Emails are simulated in this demo.</p>
        <div class="row g-3">
          <div class="col-md-6">
            <div class="card p-3">
              <small class="text-muted">Last Broadcast</small>
              <div class="fw-semibold mt-2">Benefits update ‚Äî Oct 10, 2025</div>
              <div class="small text-muted">Sent to: All investors</div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card p-3">
              <small class="text-muted">Queued Broadcasts</small>
              <div class="fw-semibold mt-2">2 scheduled</div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div> <!-- /.tab-content -->

</div> <!-- /.container -->

<!-- ===================== MODALS ===================== -->

<!-- Create Ticket Modal -->
<div class="modal fade" id="createTicketModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title">Create Support Ticket</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="createTicketForm">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Investor Name</label>
              <input type="text" id="newTicketInvestor" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Investor Email</label>
              <input type="email" id="newTicketEmail" class="form-control" required>
            </div>
            <div class="col-12">
              <label class="form-label">Subject</label>
              <input type="text" id="newTicketSubject" class="form-control" required>
            </div>
            <div class="col-12">
              <label class="form-label">Message</label>
              <textarea id="newTicketMessage" class="form-control" rows="4" required></textarea>
            </div>
            <div class="col-md-6">
              <label class="form-label">Assign To</label>
              <select id="newTicketAssignee" class="form-select">
                <option>Support Staff</option>
                <option>Finance Admin</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Priority</label>
              <select id="newTicketPriority" class="form-select">
                <option>Normal</option>
                <option>High</option>
                <option>Urgent</option>
              </select>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" type="submit">Create Ticket</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- View Ticket & Reply Modal -->
<div class="modal fade" id="viewTicketModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title">Ticket <span id="vtTicketId" class="text-primary"></span> ‚Äî <small id="vtSubject"></small></h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="row g-3">
          <div class="col-lg-8">
            <div id="conversation" class="mb-3" style="max-height:420px; overflow:auto; padding-right:8px;">
              <!-- messages appended here -->
            </div>

            <form id="replyForm">
              <div class="mb-2">
                <label class="form-label">Reply</label>
                <textarea id="replyMessage" class="form-control" rows="3" placeholder="Write your reply..." required></textarea>
              </div>
              <div class="d-flex gap-2">
                <input id="replyAttachment" type="file" class="form-control form-control-sm" />
                <button class="btn btn-primary ms-auto" type="submit">Send Reply</button>
              </div>
            </form>
          </div>

          <div class="col-lg-4">
            <div class="card p-3">
              <h6 class="mb-2">Ticket Details</h6>
              <div class="small text-muted">Investor</div>
              <div id="vtInvestor" class="mb-2 fw-semibold"></div>

              <div class="small text-muted">Assigned To</div>
              <div id="vtAssignee" class="mb-2"></div>

              <div class="small text-muted">Status</div>
              <div id="vtStatus" class="mb-3"></div>

              <div class="small text-muted">Priority</div>
              <div id="vtPriority" class="mb-3"></div>

              <div class="d-grid gap-2">
                <button id="vtMarkResolved" class="btn btn-success btn-sm">Mark Resolved</button>
                <button id="vtReassign" class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#reassignModal">Reassign</button>
                <button id="vtCloseTicket" class="btn btn-danger btn-sm">Close Ticket</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Reassign Modal -->
<div class="modal fade" id="reassignModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title">Reassign Ticket</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <label class="form-label">Assign to</label>
        <select id="reassignTo" class="form-select">
          <option>Support Staff</option>
          <option>Finance Admin</option>
        </select>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="confirmReassign" class="btn btn-primary" data-bs-dismiss="modal">Confirm</button>
      </div>
    </div>
  </div>
</div>

<!-- FAQ Add Modal -->
<div class="modal fade" id="faqAddModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title">Add FAQ</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="faqAddForm">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Question</label>
            <input id="faqQ" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Answer</label>
            <textarea id="faqA" class="form-control" rows="5" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <input id="faqCategory" class="form-control" placeholder="e.g. Wallet, ROI, Withdrawals">
          </div>
          <div class="form-check">
            <input id="faqVisible" class="form-check-input" type="checkbox" checked>
            <label class="form-check-label">Visible to users</label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-success" type="submit">Add FAQ</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- FAQ Edit Modal -->
<div class="modal fade" id="faqEditModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title">Edit FAQ</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="faqEditForm">
        <div class="modal-body">
          <input type="hidden" id="faqEditId">
          <div class="mb-3">
            <label class="form-label">Question</label>
            <input id="faqEditQ" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Answer</label>
            <textarea id="faqEditA" class="form-control" rows="5" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <input id="faqEditCategory" class="form-control">
          </div>
          <div class="form-check">
            <input id="faqEditVisible" class="form-check-input" type="checkbox">
            <label class="form-check-label">Visible to users</label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" type="submit">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- FAQ Delete Confirm Modal -->
<div class="modal fade" id="faqDeleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title text-danger">Delete FAQ</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to permanently delete this FAQ?</p>
        <p id="faqDeletePreview" class="small text-muted"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="confirmFaqDelete" class="btn btn-danger" data-bs-dismiss="modal">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Compose / Bulk Email Modal -->
<div class="modal fade" id="composeModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title">Compose Bulk Email / Notification</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form id="composeForm">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Recipients</label>
            <div class="d-flex gap-2">
              <select id="composeRecipientType" class="form-select w-auto">
                <option value="all">All investors</option>
                <option value="single">Single investor</option>
                <option value="custom">Custom emails</option>
              </select>
              <input id="composeSingleEmail" class="form-control d-none" placeholder="Investor email (single)"/>
              <input id="composeCustomEmails" class="form-control d-none" placeholder="Comma separated emails"/>
            </div>
            <div class="form-text small text-muted mt-1">Choose who will receive the message.</div>
          </div>

          <div class="mb-3">
            <label class="form-label">Subject</label>
            <input id="composeSubject" class="form-control" required/>
          </div>

          <div class="mb-3">
            <label class="form-label">Message</label>
            <textarea id="composeBody" class="form-control" rows="6" required></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Attachments</label>
            <input id="composeAttachment" type="file" class="form-control" multiple />
            <div class="form-text small text-muted">Attachments are simulated in this demo (not uploaded).</div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" type="submit"><i class="bi bi-send"></i> Send</button>
        </div>
      </form>
    </div>
  </div>
</div>


<!-- ===================== SCRIPTS (Data + Logic) ===================== -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
/* -------------------------------------------------------------------------
   Demo data & utilities - replace with server API integration
   -------------------------------------------------------------------------*/
const demoTickets = [
  {
    id: 'TK-00213',
    investor: 'John Doe',
    email: 'john@example.com',
    subject: 'Withdrawal Delay',
    messages: [
      {from:'investor', text:'I made a withdrawal 3 days ago, still not received.', time:'2025-10-12 14:30'},
      {from:'admin', text:'Hi John ‚Äî we are checking with payments. Please hold on.', time:'2025-10-12 15:10'}
    ],
    assigned: 'Support Staff',
    status: 'open',
    priority: 'Normal',
    updated: '2025-10-12 15:10'
  },
  {
    id: 'TK-00209',
    investor: 'Mary Johnson',
    email: 'mary@example.com',
    subject: 'ROI not reflecting',
    messages: [
      {from:'investor', text:'My ROI not showing in wallet.', time:'2025-10-11 11:12'},
      {from:'admin', text:'Resolved ‚Äî please refresh your wallet page.', time:'2025-10-11 12:05'}
    ],
    assigned: 'Finance Admin',
    status: 'resolved',
    priority: 'High',
    updated: '2025-10-11 12:05'
  }
];

let tickets = JSON.parse(JSON.stringify(demoTickets)); // clone for working demo

const demoFaqs = [
  { id: 'FQ1', q: 'How do I withdraw?', a: 'Go to Wallet ‚Üí Withdraw and follow steps.', category:'Wallet', visible:true, updated:'2025-09-12'},
  { id: 'FQ2', q: 'When do I get ROI?', a: 'ROI is paid after maturity of your plan.', category:'ROI', visible:true, updated:'2025-09-20'}
];

let faqs = JSON.parse(JSON.stringify(demoFaqs));

/* utilities */
function uid(prefix='id'){ return prefix + Math.random().toString(36).slice(2,9).toUpperCase(); }
function formatDateNow(){ return new Date().toISOString().slice(0,16).replace('T',' '); }

/* --------------------------- Tickets Table --------------------------- */
let ticketsTable;

function renderTicketsTable(){
  const tbody = $('#ticketsTable tbody').empty();
  tickets.forEach((t,i)=>{
    const tr = $('<tr>');
    tr.append(`<td>${i+1}</td>`);
    tr.append(`<td>${t.id}</td>`);
    tr.append(`<td>${t.investor}<div class="small text-muted">${t.email}</div></td>`);
    tr.append(`<td>${t.subject}</td>`);
    tr.append(`<td>${t.assigned}</td>`);
    const statusBadge = t.status === 'open' ? '<span class="badge bg-warning text-dark">Open</span>' : (t.status==='pending' ? '<span class="badge bg-info text-dark">Pending</span>' : '<span class="badge bg-success">Resolved</span>');
    tr.append(`<td>${statusBadge}</td>`);
    tr.append(`<td>${t.updated}</td>`);
    tr.append(`
      <td>
        <div class="d-flex gap-1">
          <button class="btn btn-sm btn-outline-primary viewTicketBtn" data-id="${t.id}"><i class="bi bi-eye"></i></button>
          <button class="btn btn-sm btn-outline-secondary replyTicketBtn" data-id="${t.id}"><i class="bi bi-reply"></i></button>
          <button class="btn btn-sm btn-outline-danger deleteTicketBtn" data-id="${t.id}"><i class="bi bi-trash"></i></button>
        </div>
      </td>`);
    tbody.append(tr);
  });

  // init / re-draw DataTable
  if($.fn.DataTable.isDataTable('#ticketsTable')){
    ticketsTable.clear().destroy();
  }
  ticketsTable = $('#ticketsTable').DataTable({
    responsive: true,
    pageLength: 6,
    order: [[6,'desc']],
    columnDefs: [{ orderable:false, targets:7 }]
  });

  updateTicketStats();
}

/* ticket stats */
function updateTicketStats(){
  $('#statTotal').text(tickets.length);
  $('#statOpen').text(tickets.filter(t=>t.status==='open').length);
  $('#statResolved').text(tickets.filter(t=>t.status==='resolved').length);
  $('#statPending').text(tickets.filter(t=>t.status==='pending').length);
}

/* open ticket modal */
let activeTicketId = null;
function openTicketModal(id){
  const ticket = tickets.find(t=>t.id===id);
  if(!ticket) return alert('Ticket not found');
  activeTicketId = id;
  $('#vtTicketId').text(ticket.id);
  $('#vtSubject').text(ticket.subject);
  $('#vtInvestor').text(ticket.investor + ' (' + ticket.email + ')');
  $('#vtAssignee').text(ticket.assigned);
  $('#vtStatus').html(ticket.status === 'open' ? '<span class="badge bg-warning text-dark">Open</span>' : (ticket.status==='pending' ? '<span class="badge bg-info text-dark">Pending</span>' : '<span class="badge bg-success">Resolved</span>'));
  $('#vtPriority').text(ticket.priority);
  $('#conversation').empty();

  // populate conversation
  ticket.messages.forEach(m=>{
    const div = document.createElement('div');
    div.className = 'd-flex';
    const bubble = document.createElement('div');
    bubble.className = 'bubble ' + (m.from==='admin' ? 'from-admin ms-auto' : 'from-investor');
    bubble.innerHTML = `<div class="small text-muted">${m.time}</div><div>${m.text}</div>`;
    div.appendChild(bubble);
    $('#conversation').append(div);
  });

  const viewModal = new bootstrap.Modal(document.getElementById('viewTicketModal'));
  viewModal.show();
}

/* reply to ticket */
$('#replyForm').on('submit', function(e){
  e.preventDefault();
  const text = $('#replyMessage').val().trim();
  if(!text) return;
  const ticket = tickets.find(t=>t.id===activeTicketId);
  ticket.messages.push({from:'admin', text, time: formatDateNow()});
  ticket.updated = formatDateNow();
  // keep ticket open unless admin marks resolved
  renderTicketsTable();
  openTicketModal(activeTicketId);
  $('#replyMessage').val('');
  alert('Reply sent (demo). Replace with API call to store message and notify user.');
});

/* mark resolved */
$('#vtMarkResolved').on('click', function(){
  if(!activeTicketId) return;
  const t = tickets.find(x=>x.id===activeTicketId);
  t.status = 'resolved';
  t.updated = formatDateNow();
  renderTicketsTable();
  openTicketModal(activeTicketId);
});

/* reassign confirm */
$('#confirmReassign').on('click', function(){
  const newAssignee = $('#reassignTo').val();
  if(!activeTicketId) return;
  const t = tickets.find(x=>x.id===activeTicketId);
  t.assigned = newAssignee;
  t.updated = formatDateNow();
  renderTicketsTable();
  alert('Ticket reassigned (demo). Implement API call to update assignment.');
});

/* delete ticket */
$(document).on('click', '.deleteTicketBtn', function(){
  const id = $(this).data('id');
  if(!confirm('Delete ticket ' + id + '? This action cannot be undone (demo).')) return;
  tickets = tickets.filter(t=>t.id!==id);
  renderTicketsTable();
});

/* quick reply button from table opens modal and focuses reply */
$(document).on('click', '.replyTicketBtn', function(){
  const id = $(this).data('id');
  openTicketModal(id);
  setTimeout(()=> $('#replyMessage').focus(), 300);
});

/* view button */
$(document).on('click', '.viewTicketBtn', function(){
  const id = $(this).data('id');
  openTicketModal(id);
});

/* create ticket */
$('#createTicketForm').on('submit', function(e){
  e.preventDefault();
  const investor = $('#newTicketInvestor').val().trim();
  const email = $('#newTicketEmail').val().trim();
  const subject = $('#newTicketSubject').val().trim();
  const message = $('#newTicketMessage').val().trim();
  const assigned = $('#newTicketAssignee').val();
  const priority = $('#newTicketPriority').val();

  const newT = {
    id: uid('TK-'),
    investor, email, subject,
    messages: [{from:'investor', text: message, time: formatDateNow()}],
    assigned, status:'open', priority, updated: formatDateNow()
  };
  tickets.unshift(newT);
  $('#createTicketModal').modal('hide');
  $('#createTicketForm')[0].reset();
  renderTicketsTable();
  alert('Ticket created (demo). Hook this to backend create-ticket endpoint.');
});

/* filters */
$('#ticketSearch').on('input', function(){
  ticketsTable.search(this.value).draw();
});
$('#ticketStatusFilter').on('change', function(){
  const v = this.value;
  if(!v) ticketsTable.column(5).search('').draw();
  else ticketsTable.column(5).search(v, true, false).draw();
});
$('#ticketAssigneeFilter').on('change', function(){ ticketsTable.column(4).search(this.value).draw(); });
$('#refreshTicketsBtn').on('click', ()=> renderTicketsTable());

/* --------------------------- FAQ CRUD --------------------------- */
let faqTable;

function renderFaqTable(){
  const tbody = $('#faqTable tbody').empty();
  faqs.forEach((f,i)=>{
    tbody.append(`<tr>
      <td>${i+1}</td>
      <td><div class="fw-semibold">${f.q}</div><div class="small text-muted">${f.a.slice(0,120)}${f.a.length>120?'...':''}</div></td>
      <td>${f.category||'General'}</td>
      <td>${f.visible ? '<span class="badge bg-success">Public</span>' : '<span class="badge bg-secondary">Hidden</span>'}</td>
      <td>${f.updated || '-'}</td>
      <td>
        <div class="d-flex gap-1">
          <button class="btn btn-sm btn-outline-primary faq-edit" data-id="${f.id}"><i class="bi bi-pencil"></i></button>
          <button class="btn btn-sm btn-outline-danger faq-delete" data-id="${f.id}"><i class="bi bi-trash"></i></button>
        </div>
      </td>
    </tr>`);
  });

  if($.fn.DataTable.isDataTable('#faqTable')){
    faqTable.clear().destroy();
  }
  faqTable = $('#faqTable').DataTable({ responsive:true, pageLength:5, columnDefs:[{orderable:false, targets:5}] });
}

/* add faq */
$('#faqAddForm').on('submit', function(e){
  e.preventDefault();
  const q = $('#faqQ').val().trim();
  const a = $('#faqA').val().trim();
  const cat = $('#faqCategory').val().trim();
  const vis = $('#faqVisible').is(':checked');
  const newFaq = { id: uid('FQ'), q, a, category:cat, visible:vis, updated: formatDateNow().split(' ')[0] };
  faqs.unshift(newFaq);
  $('#faqAddModal').modal('hide');
  $('#faqAddForm')[0].reset();
  renderFaqTable();
  alert('FAQ added (demo). Hook to backend to persist.');
});

/* edit - open modal with data */
$(document).on('click', '.faq-edit', function(){
  const id = $(this).data('id');
  const f = faqs.find(x=>x.id===id);
  if(!f) return alert('FAQ not found');
  $('#faqEditId').val(f.id);
  $('#faqEditQ').val(f.q);
  $('#faqEditA').val(f.a);
  $('#faqEditCategory').val(f.category);
  $('#faqEditVisible').prop('checked', !!f.visible);
  $('#faqEditModal').modal('show');
});

/* save faq edits */
$('#faqEditForm').on('submit', function(e){
  e.preventDefault();
  const id = $('#faqEditId').val();
  const f = faqs.find(x=>x.id===id);
  if(!f) return alert('FAQ not found');
  f.q = $('#faqEditQ').val().trim();
  f.a = $('#faqEditA').val().trim();
  f.category = $('#faqEditCategory').val().trim();
  f.visible = $('#faqEditVisible').is(':checked');
  f.updated = formatDateNow().split(' ')[0];
  $('#faqEditModal').modal('hide');
  renderFaqTable();
  alert('FAQ updated (demo). Sync to backend to persist.');
});

/* delete - confirm */
let faqToDelete = null;
$(document).on('click', '.faq-delete', function(){
  const id = $(this).data('id');
  const f = faqs.find(x=>x.id===id);
  if(!f) return;
  faqToDelete = id;
  $('#faqDeletePreview').text(f.q);
  $('#faqDeleteModal').modal('show');
});
$('#confirmFaqDelete').on('click', function(){
  if(!faqToDelete) return;
  faqs = faqs.filter(x=>x.id!==faqToDelete);
  faqToDelete = null;
  renderFaqTable();
  alert('FAQ deleted (demo).');
});

/* FAQ search */
$('#faqSearch').on('input', function(){
  faqTable.search(this.value).draw();
});

/* ---------------------- Compose / Bulk Email ---------------------- */
$('#composeRecipientType').on('change', function(){
  const v = this.value;
  $('#composeSingleEmail, #composeCustomEmails').addClass('d-none').val('');
  if(v==='single') $('#composeSingleEmail').removeClass('d-none');
  if(v==='custom') $('#composeCustomEmails').removeClass('d-none');
});

$('#composeForm').on('submit', function(e){
  e.preventDefault();
  const recipType = $('#composeRecipientType').val();
  const subject = $('#composeSubject').val().trim();
  const body = $('#composeBody').val().trim();
  const attachments = $('#composeAttachment')[0].files;

  // build recipient list simulation
  let recipients = [];
  if(recipType === 'all') {
    recipients = ['all_investors@example.com']; // in real app you'd expand to all emails server-side
  } else if(recipType === 'single') {
    const single = $('#composeSingleEmail').val().trim();
    if(!single) return alert('Enter recipient email');
    recipients = [single];
  } else {
    const custom = $('#composeCustomEmails').val().split(',').map(s=>s.trim()).filter(Boolean);
    if(custom.length===0) return alert('Enter at least one email');
    recipients = custom;
  }

  // simulate send
  console.log('SENDING EMAIL (demo):', {recipients, subject, body, attachmentsCount: attachments.length});
  $('#composeModal').modal('hide');
  $('#composeForm')[0].reset();
  $('#composeSingleEmail,#composeCustomEmails').addClass('d-none');
  alert(`Message queued to ${recipients.length} recipient(s) (demo). Integrate with your email provider: SendGrid / SES / SMTP.`);
});

/* ---------------------- Init on load ---------------------- */
$(document).ready(function(){
  renderTicketsTable();
  renderFaqTable();

  // initialize small UI behaviors
  $('#ticketStatusFilter, #ticketAssigneeFilter').val('');
  $('#ticketSearch').on('keyup', function(){ ticketsTable.search(this.value).draw(); });

  // demo: clicking "delete" in ticket row is wired above
});
</script>

        
    </div>

    <!-- Footer -->
    <footer class="footer py-3 text-center border-top mt-auto">
      <p class="mb-0 small text-muted">¬© 2025 AdminPanel. Built with ‚ù§Ô∏è by BenCode Team</p>
    </footer>
  </main>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="Js/main.js"></script>
</body>
</html>
